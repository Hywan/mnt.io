<!doctype html>
<html lang="en">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta http-equiv="content-security-policy" content="default-src 'self'; child-src 'self' https://www.youtube-nocookie.com; script-src 'self' https://cloud.umami.is">
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Announcing the first Java library to run WebAssembly: Wasmer JNI</title>

  <link rel="stylesheet" href="https://mnt.io/style/min/main.css?h=07499e1a541446a085e6" />
  <link rel="stylesheet" href="https://mnt.io/style/min/syntax-theme.css?h=ef9797b0398b3ffe9058" />

  <meta name="author" content="Ivan Enderlin" />
  <meta name="description" content="This article presents the `wasmer-java` project: the first Java library to run WebAssembly." />
  <meta name="keywords" content="rust, webassembly, java, runtime, binding" />
  <meta property="og:title" content="Announcing the first Java library to run WebAssembly: Wasmer JNI" />
  <meta property="og:site_name" content="mnt.io" />
  <meta property="og:locale" content="en_GB" />
  <meta property="og:type" content="article" />
  <meta property="og:url" content="https://mnt.io/articles/announcing-the-first-java-library-to-run-webassembly-wasmer-jni/" />
  <meta property="og:image" content="https://mnt.io/image/site-poster.jpg">
  <meta name="fediverse:creator" content="@hywan@floss.social" />
</head>
<body class="content-grid">

<nav id="menu" class="full-width content-grid">
  <ul>
    <li><a href="/">Home</a></li>
    <li><a href="https://mnt.io/articles/">Articles</a></li>
    <li><a href="https://mnt.io/series/">Series</a></li>
    <li><a href="https://matrix.to/#/&#x23;mnt_io:matrix.org" title="Public Matrix room to discuss about this blog's content">Discuss</a></li>
  </ul>
</nav>

<main vocab="https://schema.org">

  <article class="article" typeof="Article">
    <header>
      <h1 property="name">Announcing the first Java library to run WebAssembly: Wasmer JNI</h1>

      
  <div class="metadata">
    <time title="Published date" datetime="2020-05-13" property="datePublished">May 13, 2020</time>
    <span title="Reading time" property="timeRequired" content="PT7M">7 minutes read</span>
    
    <span title="Keywords" property="keywords" content="rust, webassembly, java, runtime, binding">
      Keywords:&nbsp;<a href="/keywords/rust">rust</a>, <a href="/keywords/webassembly">webassembly</a>, <a href="/keywords/java">java</a>, <a href="/keywords/runtime">runtime</a>, <a href="/keywords/binding">binding</a></span>
    
      <span><a href="https://github.com/Hywan/mnt.io/edit/main/content/articles&#x2F;2020-05-13-announcing-the-first-java-library-to-run-webassembly-wasmer-jni&#x2F;index.md" title="Submit a patch for this page">Edit</a> this page</span>
      
      <meta property="description" content="This article presents the `wasmer-java` project: the first Java library to run WebAssembly." />
      
    
  </div>

    </header>

    <p><em>This is a copy of <a href="https://medium.com/wasmer/announcing-the-first-java-library-to-run-webassembly-wasmer-jni-89e319d2ac7c">an article I wrote for
Wasmer</a>.</em></p>
<hr />
<p><a href="https://webassembly.org/">WebAssembly</a> is a portable binary format.
That means the same file can run anywhere.</p>
<blockquote>
<p>To uphold this bold statement, each language, platform and system must
be able to run WebAssembly — as fast and safely as possible.</p>
</blockquote>
<p>People who are familiar with Wasmer are used to this kind of
announcement! Wasmer is written in Rust, and comes with an additional
native C API. But you can use it in a lot of other languages. After
having announced libraries to use Wasmer, and thus WebAssembly, in:</p>
<ul>
<li>
<p><a href="https://github.com/wasmerio/php-ext-wasm"><strong>PHP</strong> with the <code>ext/wasm</code>
extension</a>,</p>
</li>
<li>
<p><a href="https://github.com/wasmerio/python-ext-wasm"><strong>Python</strong> with the <code>wasmer</code>
library</a>,</p>
</li>
<li>
<p><a href="https://github.com/wasmerio/ruby-ext-wasm"><strong>Ruby</strong> with the <code>wasmer</code>
library</a>,</p>
</li>
<li>
<p><a href="https://github.com/wasmerio/go-ext-wasm"><strong>Go</strong> with the <code>wasmer</code>
library</a> (see <a href="https://medium.com/wasmer/announcing-the-fastest-webassembly-runtime-for-go-wasmer-19832d77c050">Announcing
the fastest WebAssembly runtime for
Go: <code>wasmer</code></a>,
and even</p>
</li>
<li>
<p><a href="https://github.com/wasmerio/postgres-ext-wasm"><strong>Postgres</strong> with the <code>wasmer</code>
library</a> (see
<a href="https://medium.com/wasmer/announcing-the-first-postgres-extension-to-run-webassembly-561af2cfcb1">Announcing the first Postgres extension to run
WebAssembly</a>),</p>
</li>
<li>
<p>and many other contributions in
<a href="https://github.com/migueldeicaza/WasmerSharp">.NET/C#</a>,
<a href="https://github.com/dirkschumacher/wasmr">R</a> and
<a href="https://github.com/tessi/wasmex">Elixir</a>…</p>
</li>
</ul>
<p>…we are jazzed to announce that <strong><a href="https://github.com/wasmerio/java-ext-wasm">Wasmer has now landed in
Java</a></strong>!</p>
<p>Let’s discover the Wasmer JNI library together.</p>
<h1 id="installation">Installation</h1>
<p>The Wasmer JNI (<em>Java Native Interface</em>) library is based on the <a href="https://github.com/wasmerio/wasmer">Wasmer
runtime</a>, which is written in
<a href="https://www.rust-lang.org/">Rust</a>, and is compiled to a shared library.
For your convenience, we produce one JAR (<em>Java Archive</em>) per
architecture and platform. By now, the following are supported,
consistently tested, and pre-packaged (available in
<a href="https://bintray.com/wasmer/wasmer-jni/wasmer-jni">Bintray</a> and <a href="https://github.com/wasmerio/java-ext-wasm/releases">Github
Releases</a>):</p>
<ul>
<li>
<p><code>amd64-darwin</code> for macOS, x86 64bits,</p>
</li>
<li>
<p><code>amd64-linux</code> for Linux, x86 64 bits,</p>
</li>
<li>
<p><code>amd64-windows</code> for Windows, x86 64 bits.</p>
</li>
</ul>
<p>More architectures and more platforms will be added in the near future.
If you need a specific one, <a href="https://github.com/wasmerio/java-ext-wasm/issues/new?assignees=&amp;labels=%F0%9F%8E%89+enhancement&amp;template=---feature-request.md&amp;title=">feel free to
ask</a>!
However, it is possible to <a href="https://github.com/wasmerio/java-ext-wasm#development">produce your own JAR for your own platform
and
architecture</a>.</p>
<p>The JAR files are named as follows:
<code>wasmer-jni-$(architecture)-$(os)-$(version).jar</code>. Thus, to include
Wasmer JNI as a dependency of your project (assuming you use
<a href="http://gradle.org/">Gradle</a>), write for instance:</p>
<pre class="z-code"><code><span class="z-text z-plain">dependencies {
</span><span class="z-text z-plain">    implementation &quot;org.wasmer:wasmer-jni-amd64-linux:0.2.0&quot;
</span><span class="z-text z-plain">}
</span></code></pre>
<p>JAR are hosted on the Bintray/JCenter repository under the
<code>[wasmer-jni](https://bintray.com/wasmer/wasmer-jni/wasmer-jni)</code>
project. They are also attached to our <a href="https://github.com/wasmerio/java-ext-wasm/releases">Github releases as
assets</a>.</p>
<h1 id="calling-a-webassembly-function-from-java">Calling a WebAssembly function from Java</h1>
<p>As usual, let’s start with a simple Rust program that we will compile to
WebAssembly, and then execute from Java.</p>
<pre data-lang="rust" class="language-rust z-code"><code class="language-rust" data-lang="rust"><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">no_mangle</span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-keyword z-other z-rust">extern</span> <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">sum</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-variable z-parameter z-rust">x</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-storage z-type z-rust">i32</span>, <span class="z-variable z-parameter z-rust">y</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-storage z-type z-rust">i32</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-&gt;</span> <span class="z-storage z-type z-rust">i32</span></span> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    x <span class="z-keyword z-operator z-arithmetic z-rust">+</span> y
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre>
<p>After compilation to WebAssembly, we get a file like <a href="https://github.com/wasmerio/java-ext-wasm/raw/master/examples/simple.wasm">this
one</a>,
named <code>simple.wasm</code>.</p>
<p>The following Java program executes the <code>sum</code> exported function by
passing <code>5</code> and <code>37</code> as arguments:</p>
<pre data-lang="java" class="language-java z-code"><code class="language-java" data-lang="java"><span class="z-source z-java"><span class="z-meta z-import z-java"><span class="z-keyword z-control z-import z-java">import</span> <span class="z-meta z-path z-java"><span class="z-support z-type z-package z-java">org</span></span><span class="z-meta z-path z-java"><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-support z-type z-package z-java">wasmer</span><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-support z-class z-import z-java">Instance</span></span></span><span class="z-punctuation z-terminator z-java">;</span>
</span><span class="z-source z-java">
</span><span class="z-source z-java"><span class="z-meta z-import z-java"><span class="z-keyword z-control z-import z-java">import</span> <span class="z-meta z-path z-java"><span class="z-support z-type z-package z-java">java</span></span><span class="z-meta z-path z-java"><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-support z-type z-package z-java">io</span><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-support z-class z-import z-java">IOException</span></span></span><span class="z-punctuation z-terminator z-java">;</span>
</span><span class="z-source z-java"><span class="z-meta z-import z-java"><span class="z-keyword z-control z-import z-java">import</span> <span class="z-meta z-path z-java"><span class="z-support z-type z-package z-java">java</span></span><span class="z-meta z-path z-java"><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-support z-type z-package z-java">nio</span><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-support z-type z-package z-java">file</span><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-support z-class z-import z-java">Files</span></span></span><span class="z-punctuation z-terminator z-java">;</span>
</span><span class="z-source z-java"><span class="z-meta z-import z-java"><span class="z-keyword z-control z-import z-java">import</span> <span class="z-meta z-path z-java"><span class="z-support z-type z-package z-java">java</span></span><span class="z-meta z-path z-java"><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-support z-type z-package z-java">nio</span><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-support z-type z-package z-java">file</span><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-support z-class z-import z-java">Paths</span></span></span><span class="z-punctuation z-terminator z-java">;</span>
</span><span class="z-source z-java">
</span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-identifier z-java"><span class="z-storage z-type z-java">class</span> <span class="z-entity z-name z-class z-java">SimpleExample</span></span> <span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-punctuation z-section z-block z-begin z-java">{</span>
</span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java">    <span class="z-storage z-modifier z-java">public</span> <span class="z-storage z-modifier z-java">static</span> <span class="z-meta z-method z-java"><span class="z-storage z-type z-void z-java">void</span> <span class="z-meta z-method z-identifier z-java"><span class="z-entity z-name z-function z-java">main</span></span><span class="z-meta z-method z-parameters z-java"><span class="z-meta z-parens z-java"><span class="z-punctuation z-section z-parens z-begin z-java">(</span><span class="z-support z-class z-java">String</span><span class="z-storage z-modifier z-array z-java">[]</span> <span class="z-variable z-parameter z-java">args</span><span class="z-punctuation z-section z-parens z-end z-java">)</span></span></span> <span class="z-meta z-method z-throws z-java"><span class="z-keyword z-declaration z-throws z-java">throws</span> <span class="z-support z-class z-java">IOException</span> </span><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java"><span class="z-punctuation z-section z-block z-begin z-java">{</span></span></span></span><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">        <span class="z-comment z-line z-double-slash z-java"><span class="z-punctuation z-definition z-comment z-java">//</span> Read the WebAssembly bytes.
</span></span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">        <span class="z-storage z-type z-primitive z-java">byte</span><span class="z-storage z-modifier z-array z-java">[]</span> bytes <span class="z-meta z-assignment z-rhs z-java"><span class="z-keyword z-operator z-assignment z-java">=</span> <span class="z-support z-class z-java">Files</span><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-meta z-function-call z-java"><span class="z-variable z-function z-java">readAllBytes</span><span class="z-punctuation z-section z-parens z-begin z-java">(</span><span class="z-support z-class z-java">Paths</span><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-meta z-function-call z-java"><span class="z-variable z-function z-java">get</span><span class="z-punctuation z-section z-parens z-begin z-java">(</span><span class="z-string z-quoted z-double z-java"><span class="z-punctuation z-definition z-string z-begin z-java">&quot;</span>simple.wasm<span class="z-punctuation z-definition z-string z-end z-java">&quot;</span></span><span class="z-punctuation z-section z-parens z-end z-java">)</span></span><span class="z-punctuation z-section z-parens z-end z-java">)</span></span></span><span class="z-punctuation z-terminator z-java">;</span>
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">        <span class="z-comment z-line z-double-slash z-java"><span class="z-punctuation z-definition z-comment z-java">//</span> Instantiate the WebAssembly module.
</span></span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">        <span class="z-support z-class z-java">Instance</span> instance <span class="z-meta z-assignment z-rhs z-java"><span class="z-keyword z-operator z-assignment z-java">=</span> <span class="z-meta z-instantiation z-java"><span class="z-keyword z-other z-storage z-new z-java">new</span> <span class="z-support z-class z-java">Instance</span><span class="z-meta z-parens z-constructor-arguments z-java"><span class="z-punctuation z-section z-parens z-begin z-java">(</span>bytes<span class="z-punctuation z-section z-parens z-end z-java">)</span></span></span></span><span class="z-punctuation z-terminator z-java">;</span>
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">        <span class="z-comment z-line z-double-slash z-java"><span class="z-punctuation z-definition z-comment z-java">//</span> Get the `sum` exported function, call it by passing 5 and 37, and get the result.
</span></span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">        <span class="z-support z-class z-java">Integer</span> result <span class="z-meta z-assignment z-rhs z-java"><span class="z-keyword z-operator z-assignment z-java">=</span> <span class="z-meta z-parens z-java"><span class="z-punctuation z-section z-parens z-begin z-java">(</span><span class="z-support z-class z-java">Integer</span><span class="z-punctuation z-section z-parens z-end z-java">)</span></span> instance<span class="z-punctuation z-accessor z-dot z-java">.</span>exports<span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-meta z-function-call z-java"><span class="z-variable z-function z-java">getFunction</span><span class="z-punctuation z-section z-parens z-begin z-java">(</span><span class="z-string z-quoted z-double z-java"><span class="z-punctuation z-definition z-string z-begin z-java">&quot;</span>sum<span class="z-punctuation z-definition z-string z-end z-java">&quot;</span></span><span class="z-punctuation z-section z-parens z-end z-java">)</span></span><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-meta z-function-call z-java"><span class="z-variable z-function z-java">apply</span><span class="z-punctuation z-section z-parens z-begin z-java">(</span><span class="z-constant z-numeric z-integer z-decimal z-java">5</span><span class="z-punctuation z-separator z-comma z-java">,</span> <span class="z-constant z-numeric z-integer z-decimal z-java">37</span><span class="z-punctuation z-section z-parens z-end z-java">)</span></span>[<span class="z-constant z-numeric z-integer z-decimal z-java">0</span>]</span><span class="z-punctuation z-terminator z-java">;</span>
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">        <span class="z-meta z-assertion z-java"><span class="z-keyword z-control z-flow z-assert z-java">assert</span> result <span class="z-keyword z-operator z-comparison z-java">==</span> <span class="z-constant z-numeric z-integer z-decimal z-java">42</span></span><span class="z-punctuation z-terminator z-java">;</span>
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">        instance<span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-meta z-function-call z-java"><span class="z-variable z-function z-java">close</span><span class="z-punctuation z-section z-parens z-begin z-java">(</span><span class="z-punctuation z-section z-parens z-end z-java">)</span></span><span class="z-punctuation z-terminator z-java">;</span>
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">    <span class="z-punctuation z-section z-block z-end z-java">}</span></span></span>
</span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-punctuation z-section z-block z-end z-java">}</span></span></span></span>
</span></code></pre>
<p>Great! We have successfully executed a Rust program, compiled to
WebAssembly, in Java. As you can see, it is pretty straightforward. The
API is very similar to the standard JavaScript API, or the other API we
have designed for PHP, Python, Go, Ruby etc.</p>
<p>The assiduous reader might have noticed the <code>[0]</code> in <code>.apply(5, 37)[0]</code>
pattern. A WebAssembly function can return zero to many values, and in
this case, we are reading the first one.</p>
<blockquote>
<p>Note: Java values passed to WebAssembly exported functions are
automatically downcasted to WebAssembly values. Types are inferred at
runtime, and casting is done automatically. Thus, a WebAssembly
function acts as any regular Java function.</p>
</blockquote>
<p>Technically, an exported function is a <em>functional interface</em> as defined
by the Java Language Specification (i.e. it is a
<code>[FunctionalInterface](https://docs.oracle.com/javase/8/docs/api/java/lang/FunctionalInterface.html)</code>).
Thus, it is possible to write the following code where <code>sum</code> is an
actual function (of kind <code>org.wasmer.exports.Function</code>):</p>
<pre data-lang="java" class="language-java z-code"><code class="language-java" data-lang="java"><span class="z-source z-java"><span class="z-meta z-import z-java"><span class="z-keyword z-control z-import z-java">import</span> <span class="z-meta z-path z-java"><span class="z-support z-type z-package z-java">org</span></span><span class="z-meta z-path z-java"><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-support z-type z-package z-java">wasmer</span><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-support z-class z-import z-java">Instance</span></span></span><span class="z-punctuation z-terminator z-java">;</span>
</span><span class="z-source z-java"><span class="z-meta z-import z-java"><span class="z-keyword z-control z-import z-java">import</span> <span class="z-meta z-path z-java"><span class="z-support z-type z-package z-java">org</span></span><span class="z-meta z-path z-java"><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-support z-type z-package z-java">wasmer</span><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-support z-type z-package z-java">exports</span><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-support z-class z-import z-java">Function</span></span></span><span class="z-punctuation z-terminator z-java">;</span>
</span><span class="z-source z-java">
</span><span class="z-source z-java"><span class="z-meta z-import z-java"><span class="z-keyword z-control z-import z-java">import</span> <span class="z-meta z-path z-java"><span class="z-support z-type z-package z-java">java</span></span><span class="z-meta z-path z-java"><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-support z-type z-package z-java">io</span><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-support z-class z-import z-java">IOException</span></span></span><span class="z-punctuation z-terminator z-java">;</span>
</span><span class="z-source z-java"><span class="z-meta z-import z-java"><span class="z-keyword z-control z-import z-java">import</span> <span class="z-meta z-path z-java"><span class="z-support z-type z-package z-java">java</span></span><span class="z-meta z-path z-java"><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-support z-type z-package z-java">nio</span><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-support z-type z-package z-java">file</span><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-support z-class z-import z-java">Files</span></span></span><span class="z-punctuation z-terminator z-java">;</span>
</span><span class="z-source z-java"><span class="z-meta z-import z-java"><span class="z-keyword z-control z-import z-java">import</span> <span class="z-meta z-path z-java"><span class="z-support z-type z-package z-java">java</span></span><span class="z-meta z-path z-java"><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-support z-type z-package z-java">nio</span><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-support z-type z-package z-java">file</span><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-support z-class z-import z-java">Paths</span></span></span><span class="z-punctuation z-terminator z-java">;</span>
</span><span class="z-source z-java">
</span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-identifier z-java"><span class="z-storage z-type z-java">class</span> <span class="z-entity z-name z-class z-java">SimpleExample</span></span> <span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-punctuation z-section z-block z-begin z-java">{</span>
</span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java">    <span class="z-storage z-modifier z-java">public</span> <span class="z-storage z-modifier z-java">static</span> <span class="z-meta z-method z-java"><span class="z-storage z-type z-void z-java">void</span> <span class="z-meta z-method z-identifier z-java"><span class="z-entity z-name z-function z-java">main</span></span><span class="z-meta z-method z-parameters z-java"><span class="z-meta z-parens z-java"><span class="z-punctuation z-section z-parens z-begin z-java">(</span><span class="z-support z-class z-java">String</span><span class="z-storage z-modifier z-array z-java">[]</span> <span class="z-variable z-parameter z-java">args</span><span class="z-punctuation z-section z-parens z-end z-java">)</span></span></span> <span class="z-meta z-method z-throws z-java"><span class="z-keyword z-declaration z-throws z-java">throws</span> <span class="z-support z-class z-java">IOException</span> </span><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java"><span class="z-punctuation z-section z-block z-begin z-java">{</span></span></span></span><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">        <span class="z-comment z-line z-double-slash z-java"><span class="z-punctuation z-definition z-comment z-java">//</span> Read the WebAssembly bytes.
</span></span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">        <span class="z-storage z-type z-primitive z-java">byte</span><span class="z-storage z-modifier z-array z-java">[]</span> bytes <span class="z-meta z-assignment z-rhs z-java"><span class="z-keyword z-operator z-assignment z-java">=</span> <span class="z-support z-class z-java">Files</span><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-meta z-function-call z-java"><span class="z-variable z-function z-java">readAllBytes</span><span class="z-punctuation z-section z-parens z-begin z-java">(</span><span class="z-support z-class z-java">Paths</span><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-meta z-function-call z-java"><span class="z-variable z-function z-java">get</span><span class="z-punctuation z-section z-parens z-begin z-java">(</span><span class="z-string z-quoted z-double z-java"><span class="z-punctuation z-definition z-string z-begin z-java">&quot;</span>simple.wasm<span class="z-punctuation z-definition z-string z-end z-java">&quot;</span></span><span class="z-punctuation z-section z-parens z-end z-java">)</span></span><span class="z-punctuation z-section z-parens z-end z-java">)</span></span></span><span class="z-punctuation z-terminator z-java">;</span>
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">        <span class="z-comment z-line z-double-slash z-java"><span class="z-punctuation z-definition z-comment z-java">//</span> Instantiate the WebAssembly module.
</span></span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">        <span class="z-support z-class z-java">Instance</span> instance <span class="z-meta z-assignment z-rhs z-java"><span class="z-keyword z-operator z-assignment z-java">=</span> <span class="z-meta z-instantiation z-java"><span class="z-keyword z-other z-storage z-new z-java">new</span> <span class="z-support z-class z-java">Instance</span><span class="z-meta z-parens z-constructor-arguments z-java"><span class="z-punctuation z-section z-parens z-begin z-java">(</span>bytes<span class="z-punctuation z-section z-parens z-end z-java">)</span></span></span></span><span class="z-punctuation z-terminator z-java">;</span>
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">        <span class="z-comment z-line z-double-slash z-java"><span class="z-punctuation z-definition z-comment z-java">//</span> Declare the `sum` function, as a regular Java function.
</span></span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">        <span class="z-support z-class z-java">Function</span> sum <span class="z-meta z-assignment z-rhs z-java"><span class="z-keyword z-operator z-assignment z-java">=</span> instance<span class="z-punctuation z-accessor z-dot z-java">.</span>exports<span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-meta z-function-call z-java"><span class="z-variable z-function z-java">getFunction</span><span class="z-punctuation z-section z-parens z-begin z-java">(</span><span class="z-string z-quoted z-double z-java"><span class="z-punctuation z-definition z-string z-begin z-java">&quot;</span>sum<span class="z-punctuation z-definition z-string z-end z-java">&quot;</span></span><span class="z-punctuation z-section z-parens z-end z-java">)</span></span></span><span class="z-punctuation z-terminator z-java">;</span>
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">        
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">        <span class="z-comment z-line z-double-slash z-java"><span class="z-punctuation z-definition z-comment z-java">//</span> Call `sum`.
</span></span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">        <span class="z-support z-class z-java">Integer</span> result <span class="z-meta z-assignment z-rhs z-java"><span class="z-keyword z-operator z-assignment z-java">=</span> <span class="z-meta z-parens z-java"><span class="z-punctuation z-section z-parens z-begin z-java">(</span><span class="z-support z-class z-java">Integer</span><span class="z-punctuation z-section z-parens z-end z-java">)</span></span> sum<span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-meta z-function-call z-java"><span class="z-variable z-function z-java">apply</span><span class="z-punctuation z-section z-parens z-begin z-java">(</span><span class="z-constant z-numeric z-integer z-decimal z-java">1</span><span class="z-punctuation z-separator z-comma z-java">,</span> <span class="z-constant z-numeric z-integer z-decimal z-java">2</span><span class="z-punctuation z-section z-parens z-end z-java">)</span></span>[<span class="z-constant z-numeric z-integer z-decimal z-java">0</span>]</span><span class="z-punctuation z-terminator z-java">;</span>
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">        <span class="z-meta z-assertion z-java"><span class="z-keyword z-control z-flow z-assert z-java">assert</span> result <span class="z-keyword z-operator z-comparison z-java">==</span> <span class="z-constant z-numeric z-integer z-decimal z-java">3</span></span><span class="z-punctuation z-terminator z-java">;</span>
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">        instance<span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-meta z-function-call z-java"><span class="z-variable z-function z-java">close</span><span class="z-punctuation z-section z-parens z-begin z-java">(</span><span class="z-punctuation z-section z-parens z-end z-java">)</span></span><span class="z-punctuation z-terminator z-java">;</span>
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">    <span class="z-punctuation z-section z-block z-end z-java">}</span></span></span>
</span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-punctuation z-section z-block z-end z-java">}</span></span></span></span>
</span></code></pre>
<p>But a WebAssembly module not only exports functions, it also exports
memory.</p>
<h1 id="reading-the-memory">Reading the memory</h1>
<p>A WebAssembly instance has one or more linear memories, a contiguous and
byte-addressable range of memory spanning from offset 0 and extending up
to a varying memory size, represented by the <code>org.wasmer.Memory</code> class.
Let’s see how to use it. Consider the following Rust program:</p>
<pre data-lang="rust" class="language-rust z-code"><code class="language-rust" data-lang="rust"><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">no_mangle</span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
</span><span class="z-source z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-keyword z-other z-rust">extern</span> <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">return_hello</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-&gt;</span> <span class="z-storage z-modifier z-rust">*const</span> <span class="z-storage z-type z-rust">u8</span></span> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust">    <span class="z-string z-quoted z-double z-rust"><span class="z-storage z-type z-string z-rust">b</span><span class="z-punctuation z-definition z-string z-begin z-rust">&quot;</span>Hello, World!<span class="z-constant z-character z-escape z-rust">\0</span><span class="z-punctuation z-definition z-string z-end z-rust">&quot;</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">as_ptr</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span></span></span><span class="z-source z-rust"><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre>
<p>The <code>return_hello</code> function returns a pointer to the statically
allocated string. The string exists in the linear memory of the
WebAssembly module. It is then possible to read it in Java:</p>
<pre data-lang="java" class="language-java z-code"><code class="language-java" data-lang="java"><span class="z-source z-java"><span class="z-meta z-import z-java"><span class="z-keyword z-control z-import z-java">import</span> <span class="z-meta z-path z-java"><span class="z-support z-type z-package z-java">org</span></span><span class="z-meta z-path z-java"><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-support z-type z-package z-java">wasmer</span><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-support z-class z-import z-java">Instance</span></span></span><span class="z-punctuation z-terminator z-java">;</span>
</span><span class="z-source z-java"><span class="z-meta z-import z-java"><span class="z-keyword z-control z-import z-java">import</span> <span class="z-meta z-path z-java"><span class="z-support z-type z-package z-java">org</span></span><span class="z-meta z-path z-java"><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-support z-type z-package z-java">wasmer</span><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-support z-class z-import z-java">Memory</span></span></span><span class="z-punctuation z-terminator z-java">;</span>
</span><span class="z-source z-java">
</span><span class="z-source z-java"><span class="z-meta z-import z-java"><span class="z-keyword z-control z-import z-java">import</span> <span class="z-meta z-path z-java"><span class="z-support z-type z-package z-java">java</span></span><span class="z-meta z-path z-java"><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-support z-type z-package z-java">io</span><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-support z-class z-import z-java">IOException</span></span></span><span class="z-punctuation z-terminator z-java">;</span>
</span><span class="z-source z-java"><span class="z-meta z-import z-java"><span class="z-keyword z-control z-import z-java">import</span> <span class="z-meta z-path z-java"><span class="z-support z-type z-package z-java">java</span></span><span class="z-meta z-path z-java"><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-support z-type z-package z-java">nio</span><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-support z-class z-import z-java">ByteBuffer</span></span></span><span class="z-punctuation z-terminator z-java">;</span>
</span><span class="z-source z-java"><span class="z-meta z-import z-java"><span class="z-keyword z-control z-import z-java">import</span> <span class="z-meta z-path z-java"><span class="z-support z-type z-package z-java">java</span></span><span class="z-meta z-path z-java"><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-support z-type z-package z-java">nio</span><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-support z-type z-package z-java">file</span><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-support z-class z-import z-java">Files</span></span></span><span class="z-punctuation z-terminator z-java">;</span>
</span><span class="z-source z-java"><span class="z-meta z-import z-java"><span class="z-keyword z-control z-import z-java">import</span> <span class="z-meta z-path z-java"><span class="z-support z-type z-package z-java">java</span></span><span class="z-meta z-path z-java"><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-support z-type z-package z-java">nio</span><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-support z-type z-package z-java">file</span><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-support z-class z-import z-java">Paths</span></span></span><span class="z-punctuation z-terminator z-java">;</span>
</span><span class="z-source z-java">
</span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-identifier z-java"><span class="z-storage z-type z-java">class</span> <span class="z-entity z-name z-class z-java">MemoryExample</span></span> <span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-punctuation z-section z-block z-begin z-java">{</span>
</span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java">    <span class="z-storage z-modifier z-java">public</span> <span class="z-storage z-modifier z-java">static</span> <span class="z-meta z-method z-java"><span class="z-storage z-type z-void z-java">void</span> <span class="z-meta z-method z-identifier z-java"><span class="z-entity z-name z-function z-java">main</span></span><span class="z-meta z-method z-parameters z-java"><span class="z-meta z-parens z-java"><span class="z-punctuation z-section z-parens z-begin z-java">(</span><span class="z-support z-class z-java">String</span><span class="z-storage z-modifier z-array z-java">[]</span> <span class="z-variable z-parameter z-java">args</span><span class="z-punctuation z-section z-parens z-end z-java">)</span></span></span> <span class="z-meta z-method z-throws z-java"><span class="z-keyword z-declaration z-throws z-java">throws</span> <span class="z-support z-class z-java">IOException</span> </span><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java"><span class="z-punctuation z-section z-block z-begin z-java">{</span></span></span></span><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">        <span class="z-comment z-line z-double-slash z-java"><span class="z-punctuation z-definition z-comment z-java">//</span> Read the WebAssembly bytes.
</span></span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">        <span class="z-storage z-type z-primitive z-java">byte</span><span class="z-storage z-modifier z-array z-java">[]</span> bytes <span class="z-meta z-assignment z-rhs z-java"><span class="z-keyword z-operator z-assignment z-java">=</span> <span class="z-support z-class z-java">Files</span><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-meta z-function-call z-java"><span class="z-variable z-function z-java">readAllBytes</span><span class="z-punctuation z-section z-parens z-begin z-java">(</span><span class="z-support z-class z-java">Paths</span><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-meta z-function-call z-java"><span class="z-variable z-function z-java">get</span><span class="z-punctuation z-section z-parens z-begin z-java">(</span><span class="z-string z-quoted z-double z-java"><span class="z-punctuation z-definition z-string z-begin z-java">&quot;</span>memory.wasm<span class="z-punctuation z-definition z-string z-end z-java">&quot;</span></span><span class="z-punctuation z-section z-parens z-end z-java">)</span></span><span class="z-punctuation z-section z-parens z-end z-java">)</span></span></span><span class="z-punctuation z-terminator z-java">;</span>
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">        <span class="z-comment z-line z-double-slash z-java"><span class="z-punctuation z-definition z-comment z-java">//</span> Instantiate the WebAssembly module.
</span></span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">        <span class="z-support z-class z-java">Instance</span> instance <span class="z-meta z-assignment z-rhs z-java"><span class="z-keyword z-operator z-assignment z-java">=</span> <span class="z-meta z-instantiation z-java"><span class="z-keyword z-other z-storage z-new z-java">new</span> <span class="z-support z-class z-java">Instance</span><span class="z-meta z-parens z-constructor-arguments z-java"><span class="z-punctuation z-section z-parens z-begin z-java">(</span>bytes<span class="z-punctuation z-section z-parens z-end z-java">)</span></span></span></span><span class="z-punctuation z-terminator z-java">;</span>
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">        <span class="z-comment z-line z-double-slash z-java"><span class="z-punctuation z-definition z-comment z-java">//</span> Get a pointer to the statically allocated string returned by `return_hello`.
</span></span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">        <span class="z-support z-class z-java">Integer</span> pointer <span class="z-meta z-assignment z-rhs z-java"><span class="z-keyword z-operator z-assignment z-java">=</span> <span class="z-meta z-parens z-java"><span class="z-punctuation z-section z-parens z-begin z-java">(</span><span class="z-support z-class z-java">Integer</span><span class="z-punctuation z-section z-parens z-end z-java">)</span></span> instance<span class="z-punctuation z-accessor z-dot z-java">.</span>exports<span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-meta z-function-call z-java"><span class="z-variable z-function z-java">getFunction</span><span class="z-punctuation z-section z-parens z-begin z-java">(</span><span class="z-string z-quoted z-double z-java"><span class="z-punctuation z-definition z-string z-begin z-java">&quot;</span>return_hello<span class="z-punctuation z-definition z-string z-end z-java">&quot;</span></span><span class="z-punctuation z-section z-parens z-end z-java">)</span></span><span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-meta z-function-call z-java"><span class="z-variable z-function z-java">apply</span><span class="z-punctuation z-section z-parens z-begin z-java">(</span><span class="z-punctuation z-section z-parens z-end z-java">)</span></span>[<span class="z-constant z-numeric z-integer z-decimal z-java">0</span>]</span><span class="z-punctuation z-terminator z-java">;</span>
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">        <span class="z-comment z-line z-double-slash z-java"><span class="z-punctuation z-definition z-comment z-java">//</span> Get the exported memory named `memory`.
</span></span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">        <span class="z-support z-class z-java">Memory</span> memory <span class="z-meta z-assignment z-rhs z-java"><span class="z-keyword z-operator z-assignment z-java">=</span> instance<span class="z-punctuation z-accessor z-dot z-java">.</span>exports<span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-meta z-function-call z-java"><span class="z-variable z-function z-java">getMemory</span><span class="z-punctuation z-section z-parens z-begin z-java">(</span><span class="z-string z-quoted z-double z-java"><span class="z-punctuation z-definition z-string z-begin z-java">&quot;</span>memory<span class="z-punctuation z-definition z-string z-end z-java">&quot;</span></span><span class="z-punctuation z-section z-parens z-end z-java">)</span></span></span><span class="z-punctuation z-terminator z-java">;</span>
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">        <span class="z-comment z-line z-double-slash z-java"><span class="z-punctuation z-definition z-comment z-java">//</span> Get a direct byte buffer view of the WebAssembly memory.
</span></span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">        <span class="z-support z-class z-java">ByteBuffer</span> memoryBuffer <span class="z-meta z-assignment z-rhs z-java"><span class="z-keyword z-operator z-assignment z-java">=</span> memory<span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-meta z-function-call z-java"><span class="z-variable z-function z-java">buffer</span><span class="z-punctuation z-section z-parens z-begin z-java">(</span><span class="z-punctuation z-section z-parens z-end z-java">)</span></span></span><span class="z-punctuation z-terminator z-java">;</span>
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">        <span class="z-comment z-line z-double-slash z-java"><span class="z-punctuation z-definition z-comment z-java">//</span> Prepare the byte array that will hold the data.
</span></span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">        <span class="z-storage z-type z-primitive z-java">byte</span><span class="z-storage z-modifier z-array z-java">[]</span> data <span class="z-meta z-assignment z-rhs z-java"><span class="z-keyword z-operator z-assignment z-java">=</span> <span class="z-meta z-instantiation z-java"><span class="z-keyword z-other z-storage z-new z-java">new</span> <span class="z-storage z-type z-primitive z-java">byte</span><span class="z-meta z-brackets z-array-initialization z-java"><span class="z-punctuation z-section z-brackets z-begin z-java">[</span><span class="z-constant z-numeric z-integer z-decimal z-java">13</span><span class="z-punctuation z-section z-brackets z-end z-java">]</span></span></span></span><span class="z-punctuation z-terminator z-java">;</span>
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">        <span class="z-comment z-line z-double-slash z-java"><span class="z-punctuation z-definition z-comment z-java">//</span> Let&#39;s position the cursor, and…
</span></span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">        memoryBuffer<span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-meta z-function-call z-java"><span class="z-variable z-function z-java">position</span><span class="z-punctuation z-section z-parens z-begin z-java">(</span>pointer<span class="z-punctuation z-section z-parens z-end z-java">)</span></span><span class="z-punctuation z-terminator z-java">;</span>
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">        
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">        <span class="z-comment z-line z-double-slash z-java"><span class="z-punctuation z-definition z-comment z-java">//</span> … read!
</span></span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">        memoryBuffer<span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-meta z-function-call z-java"><span class="z-variable z-function z-java">get</span><span class="z-punctuation z-section z-parens z-begin z-java">(</span>data<span class="z-punctuation z-section z-parens z-end z-java">)</span></span><span class="z-punctuation z-terminator z-java">;</span>
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">        <span class="z-comment z-line z-double-slash z-java"><span class="z-punctuation z-definition z-comment z-java">//</span> Let&#39;s encode back to a Java string.
</span></span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">        <span class="z-support z-class z-java">String</span> result <span class="z-meta z-assignment z-rhs z-java"><span class="z-keyword z-operator z-assignment z-java">=</span> <span class="z-meta z-instantiation z-java"><span class="z-keyword z-other z-storage z-new z-java">new</span> <span class="z-support z-class z-java">String</span><span class="z-meta z-parens z-constructor-arguments z-java"><span class="z-punctuation z-section z-parens z-begin z-java">(</span>data<span class="z-punctuation z-section z-parens z-end z-java">)</span></span></span></span><span class="z-punctuation z-terminator z-java">;</span>
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">        <span class="z-comment z-line z-double-slash z-java"><span class="z-punctuation z-definition z-comment z-java">//</span> Hello!
</span></span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">        <span class="z-meta z-assertion z-java"><span class="z-keyword z-control z-flow z-assert z-java">assert</span> result<span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-meta z-function-call z-java"><span class="z-variable z-function z-java">equals</span><span class="z-punctuation z-section z-parens z-begin z-java">(</span><span class="z-string z-quoted z-double z-java"><span class="z-punctuation z-definition z-string z-begin z-java">&quot;</span>Hello, World!<span class="z-punctuation z-definition z-string z-end z-java">&quot;</span></span><span class="z-punctuation z-section z-parens z-end z-java">)</span></span></span><span class="z-punctuation z-terminator z-java">;</span>
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">        instance<span class="z-punctuation z-accessor z-dot z-java">.</span><span class="z-meta z-function-call z-java"><span class="z-variable z-function z-java">close</span><span class="z-punctuation z-section z-parens z-begin z-java">(</span><span class="z-punctuation z-section z-parens z-end z-java">)</span></span><span class="z-punctuation z-terminator z-java">;</span>
</span></span></span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-meta z-method z-java"><span class="z-meta z-method z-body z-java">    <span class="z-punctuation z-section z-block z-end z-java">}</span></span></span>
</span></span></span></span><span class="z-source z-java"><span class="z-meta z-class z-java"><span class="z-meta z-class z-body z-java"><span class="z-meta z-block z-java"><span class="z-punctuation z-section z-block z-end z-java">}</span></span></span></span>
</span></code></pre>
<p>As we can see, the <code>Memory</code> API provides a <code>buffer</code> method. It returns a
<a href="https://docs.oracle.com/javase/8/docs/api/java/nio/ByteBuffer.html"><em>direct</em> byte
buffer</a>
(of kind <code>java.nio.ByteBuffer</code>) view of the memory. It’s a standard API
for any Java developer. We think it’s best to not reinvent the wheel and
use standard API as much as possible.</p>
<p>The WebAssembly memory is dissociated from the JVM memory, and thus from
the garbage collector.</p>
<blockquote>
<p>You can read <a href="https://github.com/wasmerio/java-ext-wasm/blob/master/examples/GreetExample.java">the Greet
Example</a>
to see a more in-depth usage of the <code>Memory</code> API.</p>
</blockquote>
<h1 id="more-documentation">More documentation</h1>
<p>The project comes with a <code>Makefile</code>. The <code>make javadoc</code> command will
generate a traditional local Javadoc for you, in the
<code>build/docs/javadoc/index.html</code> file.</p>
<p>In addition, the project’s <code>README.md</code> file has an <a href="https://github.com/wasmerio/java-ext-wasm#api-of-the-wasmer-library">API of
the <code>wasmer</code> library
Section</a>.</p>
<p>Finally, the project comes with <a href="https://github.com/wasmerio/java-ext-wasm/tree/master/examples">a set of
examples</a>.
Use the <code>make run-example EXAMPLE=Simple</code> to run the
<code>SimpleExample.java</code> example for instance.</p>
<h1 id="performance">Performance</h1>
<p>WebAssembly aims at being safe, but also fast. Since Wasmer JNI is the
<em>first</em> Java library to execute WebAssembly, we can’t compare to prior
works in the Java ecosystem. However, you might know that Wasmer comes
with 3 backends: Singlepass, Cranelift and LLVM. We’ve even written an
article about it: <a href="https://medium.com/wasmer/a-webassembly-compiler-tale-9ef37aa3b537">A WebAssembly Compiler
tale</a>.
The Wasmer JNI library uses the Cranelift backend for the moment, which
offers the best compromise between compilation-time and execution-time.</p>
<h1 id="credits">Credits</h1>
<p>Asami (<a href="https://twitter.com/d0iasm">d0iasm</a> on Twitter) has improved
this project during its internship at Wasmer under my guidance. She
finished the internship before the release of the Wasmer JNI project,
but she deserves credits for pushing the project forward! Good work
Asami!</p>
<p>This is an opportunity to remind everyone that we hire anywhere in the
world. Asami was working from Japan while I am working from Switzerland,
and the rest of the team is from US, Spain, China etc. Feel free to
contact me (<a href="https://twitter.com/mnt_io">@mnt_io</a> or
<a href="https://twitter.com/syrusakbary">@syrusakbary</a> on Twitter) if you want
to join us on this big adventure!</p>
<h1 id="conclusion">Conclusion</h1>
<p>Wasmer JNI is a library to execute WebAssembly directly in Java. It
embeds the WebAssembly runtime
<a href="https://github.com/wasmerio/wasmer">Wasmer</a>. The first releases provide
the core API with <code>Module</code>, <code>Instance</code>, and <code>Memory</code>. It comes
pre-packaged as a JAR, one per architecture and per platform.</p>
<p>The source code is open and hosted on Github at
<a href="https://github.com/wasmerio/java-ext-wasm">wasmerio/java-ext-wasm</a>.
We are constantly improving the project, so if you have feedback,
issues, or feature requests please open an issue in the repository, or
reach us on Twitter at <a href="https://twitter.com/wasmerio">@wasmerio</a> or
<a href="https://twitter.com/mnt_io">@mnt_io</a>.</p>
<p>We look forward to see what you build with this!</p>

  </article>

</main>

<footer class="full-width content-grid">
  <div class="footer">
    <div>
      <h2>Contact me</h2>

      <ul>
        <li><a href="https://matrix.to/#/@mnt_io:matrix.org" title="Say hi on Matrix">@mnt_io:matrix.org</a></li>
        <li><a href="mailto:ivan@mnt.io" title="Good ol' email">ivan@mnt.io</a></li>
        <li><a href="https://floss.social/@hywan" title="Say hi on Mastodon" rel="me">Mastodon</a></li>
        <li><a href="https://github.com/Hywan" title="Say hi on Github">Github</a></li>
      </ul>
    </div>
    <div>
      <h2>Recommendations</h2>

      <ul>
        <li><a href="https://fasterthanli.me/">fasterthanli.me</a></li>
        <li><a href="https://without.boats/blog/">without.boats</a></li>
        <li><a href="https://faultlore.com/blah/">faultlore.com</a></li>
        <li><a href="https://smallcultfollowing.com/babysteps/blog/">smallcultfollowing.com</a></li>
        <li><a href="https://orlp.net/blog/">orlp.net</a></li>
      </ul>
    </div>

    <div>
      <h2>More</h2>

      <ul>
        <li><a href="https://mnt.io/lore/">Lore</a></li>
        <li><a href="https://mnt.io/rss.xml">RSS</a></li>
        <li><a href="https://mnt.io/atom.xml">Atom</a></li>
        <li><a href="https://github.com/Hywan/mnt.io" title="Source code of this site">Source code</a></li>
        <li><a href="https://dblp.org/search/index.php?query=Ivan%20Enderlin" title="Computer Science Bibliography">DBLP</a></li>
      </ul>
    </div>
  </div>
</footer>

<script defer src="https://cloud.umami.is/script.js" data-website-id="30754987-0af7-4ea0-9bd3-711c543b6ecb"></script>
</body>
</html>
